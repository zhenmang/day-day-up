## **ASCII 码**

ASCII 码一共规定了128个字符的编码，对英语字符与二进制位之间的关系，做了统一规定，包括大小写字母、空格及其它32个控制符号。只占用了一个字节的后面7位，最前面的一位统一规定为`0`。

## **非 ASCII 编码**

英语用128个符号编码就够了，但是用来表示其他语言，128个符号是不够的。比如，在法语中，字母上方有注音符号，汉字就多达10万左右，就必须使用多个字节表达一个符号。

## **GB2312**

简体中文常见的编码方式是 GB2312，使用两个字节表示一个汉字，所以理论上最多可以表示 256 x 256 = 65536 个符号。繁体Big5 码。`严`的 GB2312 编码`D1 CF`

## Unicode

世界上存在着多种编码方式，同一个二进制数字可以被解释成不同的符号，发信人和收信人使用的编码方式不一样，就会出现乱码

可以想象，如果有一种编码，Unicode将世界上所有的符号都纳入其中。每一个符号都给予一个独一无二的编码，那么乱码问题就会消失。

## **UTF-8**

**UTF-8 是 Unicode 的实现方式之一。**

**UTF-8是一种变长的编码方法，字符长度从1个字节到4个字节不等。**越是常用的字符，字节越短，最前面的128个字符，只使用1个字节表示，与ASCII码完全相同。

UTF-8 的编码规则很简单，只有二条：

1）对于单字节的符号，字节的第一位设为`0`，后面7位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的。

2）对于`n`字节的符号（`n > 1`），第一个字节的前`n`位都设为`1`，第`n + 1`位设为`0`，后面字节的前两位一律设为`10`。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码。

## **Unicode 与 UTF-8 之间的转换**

下表总结了编码规则，字母`x`表示可用编码的位。

> ```
> Unicode符号范围     |        UTF-8编码方式
> (十六进制)        |              （二进制）
> ----------------------+---------------------------------------------
> 0000 0000-0000 007F | 0xxxxxxx
> 0000 0080-0000 07FF | 110xxxxx 10xxxxxx
> 0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
> 0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
> ```

跟据上表，解读 UTF-8 编码非常简单。如果一个字节的第一位是`0`，则这个字节单独就是一个字符；如果第一位是`1`，则连续有多少个`1`，就表示当前字符占用多少个字节。

下面，还是以汉字`严`为例，演示如何实现 UTF-8 编码。

`严`的 Unicode 是`4E25`（`100111000100101`），根据上表，可以发现`4E25`处在第三行的范围内（`0000 0800 - 0000 FFFF`），因此`严`的 UTF-8 编码需要三个字节，即格式是`1110xxxx 10xxxxxx 10xxxxxx`。然后，从`严`的最后一个二进制位开始，依次从后向前填入格式中的`x`，多出的位补`0`。这样就得到了，`严`的 UTF-8 编码是`11100100 10111000 10100101`，转换成十六进制就是`E4B8A5`。

**可以看到`严`的 Unicode码 是`4E25`，UTF-8 编码是`E4B8A5`，两者是不一样的。它们之间的转换可以通过程序实现。**

## UTF-32

**最直观的编码方法是，每个码点（unicode表示一个字符的数字）使用四个字节表示，字节内容一一对应码点。这种编码方法就叫做UTF-32。**

比如，码点0就用四个字节的0表示，码点597D就在前面加两个字节的0。

> ```javascript
> U+0000 = 0x0000 0000
> 
> U+597D = 0x0000 597D
> ```

UTF-32的优点在于，转换规则简单直观，查找效率高。缺点在于浪费空间，同样内容的英语文本，它会比ASCII编码大四倍。

## UTF-16

UTF-16编码介于UTF-32与UTF-8之间，同时结合了定长和变长两种编码方法的特点。

它的编码规则很简单：基本平面的字符占用2个字节，辅助平面的字符占用4个字节。**也就是说，UTF-16的编码长度要么是2个字节（U+0000到U+FFFF），要么是4个字节（U+010000到U+10FFFF）。**

Unicode码点转成UTF-16，公式

```javascript
H = Math.floor((c-0x10000) / 0x400)+0xD800

L = (c - 0x10000) % 0x400 + 0xDC00
```

## JavaScript编码

JavaScript语言采用Unicode字符集，编码方法既不是UTF-16，也不是UTF-8，更不是UTF-3，**JavaScript用的是UCS-2！**，原因是js的出现时间在utf-16之前。

**由于JavaScript只能处理UCS-2编码，造成所有字符在这门语言中都是2个字节，如果是4个字节的字符，会当作两个双字节的字符处理**。JavaScript的字符函数都受到这一点的影响，无法返回正确结果。

> - String.prototype.replace()
> - String.prototype.substring()
> - String.prototype.slice()
> - ...

## ECMAScript 6

ES6大幅增强了Unicode支持，基本上解决了这个问题。

**（1）正确识别字符**

ES6可以自动识别4字节的码点。因此，遍历字符串就简单多了。

> ```javascript
> for (let s of string ) {
>   // ...
> }
> ```

但是，为了保持兼容，length属性还是原来的行为方式。为了得到字符串的正确长度，可以用下面的方式。

> ```javascript
> Array.from(string).length
> ```

**（2）码点表示法**

JavaScript允许直接用码点表示Unicode字符，写法是"反斜杠+u+码点"。

> ```javascript
> '好' === '\u597D' // true
> ```

但是，这种表示法对4字节的码点无效。ES6修正了这个问题，只要将码点放在大括号内，就能正确识别。

![img](/imgs/madian.png)

**（3）字符串处理函数**

ES6新增了几个专门处理4字节码点的函数。

> - **String.fromCodePoint()**：从Unicode码点返回对应字符
> - **String.prototype.codePointAt()**：从字符返回对应的码点
> - **String.prototype.at()**：返回字符串给定位置的字符

**（4）正则表达式**

ES6提供了u修饰符，对正则表达式添加4字节码点的支持。

![img](/imgs/zhengze.png)

**（5）Unicode正规化**

有些字符除了字母以外，还有[附加符号](http://zh.wikipedia.org/wiki/附加符号)。比如，汉语拼音的Ǒ，字母上面的声调就是附加符号。对于许多欧洲语言来说，声调符号是非常重要的。

![img](/imgs/zhenggui.png)

Unicode提供了两种表示方法。一种是带附加符号的单个字符，即一个码点表示一个字符，比如Ǒ的码点是U+01D1；另一种是将附加符号单独作为一个码点，与主体字符复合显示，即两个码点表示一个字符，比如Ǒ可以写成O（U+004F） + ˇ（U+030C）。

> ```javascript
> // 方法一
> '\u01D1'
> // 'Ǒ'
> 
> // 方法二
> '\u004F\u030C'
> // 'Ǒ'
> ```

这两种表示方法，视觉和语义都完全一样，理应作为等同情况处理。但是，JavaScript无法辨别。

> ```javascript
>  '\u01D1'==='\u004F\u030C' 
>  //false
> ```

ES6提供了normalize方法，允许["Unicode正规化"](http://zh.wikipedia.org/wiki/Unicode正規化)，即将两种方法转为同样的序列。

> ```javascript
>  '\u01D1'.normalize() === '\u004F\u030C'.normalize() 
>  // true
> ```

<br>

<br>

<br>

<br>

[字符编码](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)

[js编码](http://www.ruanyifeng.com/blog/2014/12/unicode.html)

[unicode](https://home.unicode.org/)

[GB2312](http://www.chi2ko.com/tool/CJK.htm)